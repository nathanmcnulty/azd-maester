name: Copy Shared Scripts to Solutions

on:
  push:
    paths:
      - 'shared/scripts/**'
      - '.github/workflows/copy-shared-scripts.yml'
  workflow_dispatch:

jobs:
  copy-shared-scripts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Copy shared scripts to automation-account
        run: |
          mkdir -p automation-account/scripts/shared
          cp shared/scripts/*.ps1 automation-account/scripts/shared/
          cp shared/scripts/*.psm1 automation-account/scripts/shared/

      - name: Copy shared scripts to function-app
        run: |
          mkdir -p function-app/scripts/shared
          cp shared/scripts/*.ps1 function-app/scripts/shared/
          cp shared/scripts/*.psm1 function-app/scripts/shared/

      - name: Copy shared scripts to container-app-job
        run: |
          mkdir -p container-app-job/scripts/shared
          cp shared/scripts/*.ps1 container-app-job/scripts/shared/
          cp shared/scripts/*.psm1 container-app-job/scripts/shared/

      - name: Copy shared scripts to azure-devops
        run: |
          mkdir -p azure-devops/scripts/shared
          cp shared/scripts/*.ps1 azure-devops/scripts/shared/
          cp shared/scripts/*.psm1 azure-devops/scripts/shared/

      - name: Commit and push if changes
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add automation-account/scripts/shared function-app/scripts/shared container-app-job/scripts/shared azure-devops/scripts/shared
          git diff --cached --quiet || git commit -m 'chore: sync shared scripts to solution folders [automated]'
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
